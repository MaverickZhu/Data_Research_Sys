# æ™ºèƒ½å…³è”åŒ¹é…ç³»ç»ŸV2.0åŠŸèƒ½è®¾è®¡

## ğŸ¯ è®¾è®¡èƒŒæ™¯

åŸºäºç°æœ‰çš„æ¶ˆé˜²å•ä½å»ºç­‘æ•°æ®å…³è”ç³»ç»ŸV1.0ï¼Œè¯¥ç³»ç»Ÿå·²ç»å®ç°äº†æ¶ˆé˜²ç›‘ç£ç³»ç»Ÿï¼ˆxxj_shdwjbxxï¼‰å’Œå®‰å…¨æ’æŸ¥ç³»ç»Ÿï¼ˆxfaqpc_jzdwxxï¼‰ä¹‹é—´çš„æ™ºèƒ½åŒ¹é…ã€‚V2.0ç‰ˆæœ¬æ—¨åœ¨å°†ç³»ç»Ÿä»ç‰¹å®šè¡Œä¸šç³»ç»Ÿæ‰©å±•ä¸ºé€šç”¨çš„æ™ºèƒ½å…³è”åŒ¹é…å¹³å°ï¼Œæ”¯æŒä»»æ„CSVæ•°æ®æºçš„ä¸Šä¼ å’Œå¯é…ç½®çš„å…³è”åŒ¹é…ã€‚

## ğŸ—ï¸ V1.0ç°çŠ¶åˆ†æ

### æ ¸å¿ƒæŠ€æœ¯æ¶æ„
- **åˆ†å±‚ç€‘å¸ƒå¼åŒ¹é…ç­–ç•¥**ï¼šç²¾ç¡®åŒ¹é…(exact) â†’ ç»“æ„åŒ–åŒ¹é…(structured) â†’ å¢å¼ºæ¨¡ç³ŠåŒ¹é…(enhanced_fuzzy) â†’ å…¨å±€æ¨¡ç³ŠåŒ¹é…(fuzzy)
- **å¤šç»´åº¦ç›¸ä¼¼åº¦è®¡ç®—**ï¼šåŸºäºTF-IDFã€ç¼–è¾‘è·ç¦»ã€Jaro-Winklerã€ä¸­æ–‡æ‹¼éŸ³ç­‰ç®—æ³•
- **é¢„è¿‡æ»¤ä¼˜åŒ–**ï¼šé€šè¿‡æ³•äººä»£è¡¨ç­‰å…³é”®å­—æ®µé¢„ç­›é€‰ï¼Œå¤§å¹…æå‡æ¨¡ç³ŠåŒ¹é…æ•ˆç‡
- **æ•°æ®å­˜å‚¨**ï¼šMongoDB + Redisç¼“å­˜æ¶æ„
- **Webç®¡ç†ç•Œé¢**ï¼šFlask + HTML/CSS/JavaScriptå®ç°

### æ•°æ®å­—æ®µæ˜ å°„ï¼ˆV1.0å›ºåŒ–é…ç½®ï¼‰
| å­—æ®µå«ä¹‰ | å®‰å…¨æ’æŸ¥ç³»ç»Ÿ(æº) | æ¶ˆé˜²ç›‘ç£ç³»ç»Ÿ(ç›®æ ‡) | åŒ¹é…ç±»å‹ | æƒé‡ |
|---------|-----------------|------------------|----------|------|
| å•ä½åç§° | UNIT_NAME | dwmc | string | 0.4 |
| ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç  | CREDIT_CODE | tyshxydm | exact | 1.0 |
| å•ä½åœ°å€ | ADDRESS | dwdz | address | 0.3 |
| æ³•å®šä»£è¡¨äºº | LEGAL_REPRESENTATIVE | fddbr | string | 0.15 |
| å®‰å…¨ç®¡ç†äºº | CONTACT_PERSON | xfaqglr | string | 0.15 |

### æŠ€æœ¯ä¼˜åŠ¿ä¿ç•™
1. **é«˜æ•ˆçš„åˆ†å±‚åŒ¹é…ç­–ç•¥**
2. **æˆç†Ÿçš„ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•**
3. **å®æ—¶è¿›åº¦ç›‘æ§å’Œäººå·¥å®¡æ ¸æœºåˆ¶**
4. **å®Œå–„çš„ç»“æœç®¡ç†å’Œå¯¼å‡ºåŠŸèƒ½**

## ğŸš€ V2.0åŠŸèƒ½å‡çº§è®¾è®¡

### ä¸€ã€æ ¸å¿ƒåŠŸèƒ½æ‰©å±•

#### 1.1 é€šç”¨CSVæ•°æ®æºæ”¯æŒ
**åŠŸèƒ½æè¿°**ï¼šç”¨æˆ·å¯ä»¥ä¸Šä¼ ä»»æ„æ ¼å¼çš„CSVæ–‡ä»¶ä½œä¸ºä¸»è¡¨å’Œå¯¹æ¯”è¡¨ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å­—æ®µç»“æ„å¹¶æä¾›å¯è§†åŒ–é…ç½®ç•Œé¢ã€‚

**æŠ€æœ¯å®ç°**ï¼š
```python
class CSVDataManager:
    """CSVæ•°æ®ç®¡ç†å™¨"""
    
    def __init__(self, db_manager):
        self.db_manager = db_manager
        self.supported_formats = ['csv', 'xlsx', 'xls']
        self.max_file_size = 100 * 1024 * 1024  # 100MB
    
    def upload_and_analyze(self, file_stream, file_name, table_type):
        """ä¸Šä¼ å¹¶åˆ†æCSVæ–‡ä»¶ç»“æ„"""
        # 1. æ–‡ä»¶æ ¼å¼éªŒè¯
        # 2. ç¼–ç æ£€æµ‹å’Œè½¬æ¢
        # 3. å­—æ®µç»“æ„åˆ†æ
        # 4. æ•°æ®ç±»å‹æ¨æ–­
        # 5. æ•°æ®è´¨é‡æ£€æŸ¥
        pass
    
    def create_dynamic_collection(self, table_config, data_records):
        """åˆ›å»ºåŠ¨æ€æ•°æ®é›†åˆ"""
        # åŸºäºç”¨æˆ·é…ç½®åˆ›å»ºMongoDBé›†åˆ
        pass
```

**Webç•Œé¢è®¾è®¡**ï¼š
- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸï¼ˆæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼‰
- å®æ—¶é¢„è§ˆå‰10è¡Œæ•°æ®
- å­—æ®µç±»å‹è‡ªåŠ¨è¯†åˆ«
- æ•°æ®è´¨é‡æŠ¥å‘Šï¼ˆç¼ºå¤±å€¼ã€é‡å¤å€¼ç»Ÿè®¡ï¼‰

#### 1.2 æ™ºèƒ½å­—æ®µæ˜ å°„é…ç½®
**åŠŸèƒ½æè¿°**ï¼šæä¾›ç›´è§‚çš„å­—æ®µæ˜ å°„ç•Œé¢ï¼Œæ”¯æŒå­—æ®µç±»å‹é€‰æ‹©ã€æƒé‡é…ç½®å’ŒåŒ¹é…è§„åˆ™è‡ªå®šä¹‰ã€‚

**é…ç½®æ¨¡å‹**ï¼š
```python
class FieldMappingConfig:
    """å­—æ®µæ˜ å°„é…ç½®æ¨¡å‹"""
    
    def __init__(self):
        self.primary_table = None      # ä¸»è¡¨é…ç½®
        self.comparison_tables = []    # å¯¹æ¯”è¡¨é…ç½®åˆ—è¡¨
        self.mapping_rules = {}        # å­—æ®µæ˜ å°„è§„åˆ™
        self.match_strategy = {}       # åŒ¹é…ç­–ç•¥é…ç½®
    
    @dataclass
    class TableConfig:
        table_id: str
        table_name: str
        file_path: str
        total_records: int
        primary_key_field: str      # ä¸»é”®å­—æ®µ
        fields_info: Dict[str, FieldInfo]
    
    @dataclass  
    class FieldInfo:
        field_name: str
        field_type: str            # text/numeric/date/phone/address/email
        data_type: str             # string/int/float/datetime
        sample_values: List[str]   # ç¤ºä¾‹å€¼
        null_count: int            # ç©ºå€¼æ•°é‡
        unique_count: int          # å”¯ä¸€å€¼æ•°é‡
```

**æ˜ å°„è§„åˆ™è®¾è®¡**ï¼š
```yaml
field_mapping:
  primary_table: "company_data_2024"
  comparison_tables: ["tax_records", "business_licenses"]
  
  matching_pairs:
    - primary_field: "company_name"
      target_fields: 
        - table: "tax_records"
          field: "taxpayer_name"
          weight: 0.4
          match_type: "fuzzy_name"
        - table: "business_licenses" 
          field: "enterprise_name"
          weight: 0.4
          match_type: "fuzzy_name"
    
    - primary_field: "unified_credit_code"
      target_fields:
        - table: "tax_records"
          field: "credit_code"
          weight: 1.0
          match_type: "exact"
          
  similarity_config:
    threshold: 0.75
    algorithms:
      fuzzy_name: ["levenshtein", "jaro_winkler", "cosine"]
      fuzzy_address: ["geographic", "semantic"] 
      exact: ["hash_match"]
```

#### 1.3 å¯è§†åŒ–å­—æ®µå…³è”è®¾ç½®
**åŠŸèƒ½æè¿°**ï¼šæä¾›æ‹–æ‹½å¼çš„å­—æ®µå…³è”é…ç½®ç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°è®¾ç½®å­—æ®µä¹‹é—´çš„åŒ¹é…å…³ç³»ã€‚

**ç•Œé¢è®¾è®¡**ï¼š
```html
<!-- å­—æ®µæ˜ å°„é…ç½®ç•Œé¢ -->
<div class="field-mapping-container">
    <div class="table-panel" id="primary-table">
        <h3>ä¸»è¡¨å­—æ®µ</h3>
        <div class="field-list">
            <div class="field-item" draggable="true" data-field="company_name">
                <span class="field-name">å…¬å¸åç§°</span>
                <span class="field-type">æ–‡æœ¬</span>
            </div>
        </div>
    </div>
    
    <div class="mapping-area">
        <svg id="mapping-canvas"></svg>
    </div>
    
    <div class="table-panel" id="target-tables">
        <h3>å¯¹æ¯”è¡¨å­—æ®µ</h3>
        <!-- å¤šä¸ªå¯¹æ¯”è¡¨çš„å­—æ®µåˆ—è¡¨ -->
    </div>
</div>
```

### äºŒã€å¢å¼ºåŒ¹é…ç®—æ³•

#### 2.1 åŠ¨æ€åŒ¹é…ç­–ç•¥é€‚é…
**åŠŸèƒ½æè¿°**ï¼šåŸºäºç”¨æˆ·é…ç½®çš„å­—æ®µç±»å‹å’Œæ˜ å°„å…³ç³»ï¼ŒåŠ¨æ€ç”Ÿæˆæœ€ä¼˜çš„åŒ¹é…ç­–ç•¥ã€‚

```python
class DynamicMatchStrategy:
    """åŠ¨æ€åŒ¹é…ç­–ç•¥ç”Ÿæˆå™¨"""
    
    def __init__(self, field_mapping_config):
        self.config = field_mapping_config
        self.strategy_factory = MatchStrategyFactory()
    
    def generate_strategy(self):
        """åŸºäºå­—æ®µé…ç½®ç”ŸæˆåŒ¹é…ç­–ç•¥"""
        strategy = {
            'exact_match_fields': [],
            'fuzzy_match_fields': [],
            'prefilter_fields': [],
            'similarity_weights': {}
        }
        
        for mapping_pair in self.config.matching_pairs:
            if mapping_pair.match_type == 'exact':
                strategy['exact_match_fields'].append(mapping_pair)
            elif mapping_pair.match_type.startswith('fuzzy'):
                strategy['fuzzy_match_fields'].append(mapping_pair)
                
            # è‡ªåŠ¨é€‰æ‹©é¢„è¿‡æ»¤å­—æ®µï¼ˆå”¯ä¸€æ€§é«˜ä¸”è®¡ç®—æˆæœ¬ä½çš„å­—æ®µï¼‰
            if mapping_pair.field_info.unique_ratio > 0.8:
                strategy['prefilter_fields'].append(mapping_pair)
        
        return strategy
```

#### 2.2 æ™ºèƒ½ç›¸ä¼¼åº¦ç®—æ³•é€‰æ‹©
**åŠŸèƒ½æè¿°**ï¼šæ ¹æ®å­—æ®µç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€é€‚åˆçš„ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•ã€‚

```python
class SmartSimilarityCalculator:
    """æ™ºèƒ½ç›¸ä¼¼åº¦è®¡ç®—å™¨"""
    
    ALGORITHM_MAPPING = {
        'company_name': ['company_name_standardizer', 'fuzzy_string', 'semantic'],
        'person_name': ['name_standardizer', 'phonetic', 'fuzzy_string'],
        'address': ['address_parser', 'geographic', 'fuzzy_string'],
        'phone': ['phone_normalizer', 'exact_match'],
        'email': ['email_normalizer', 'exact_match'],
        'id_number': ['id_standardizer', 'exact_match'],
        'numeric': ['numeric_range', 'percentage_diff'],
        'date': ['date_range', 'temporal_similarity']
    }
    
    def calculate_field_similarity(self, field_type, value1, value2, config=None):
        """æ ¹æ®å­—æ®µç±»å‹è®¡ç®—ç›¸ä¼¼åº¦"""
        algorithms = self.ALGORITHM_MAPPING.get(field_type, ['fuzzy_string'])
        return self._ensemble_similarity(algorithms, value1, value2, config)
```

### ä¸‰ã€æ•°æ®ç®¡ç†å¢å¼º

#### 3.1 å¤šæ•°æ®æºç®¡ç†
**åŠŸèƒ½æè¿°**ï¼šæ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ªæ•°æ®æºï¼Œæä¾›æ•°æ®æºçš„å¢åˆ æ”¹æŸ¥å’Œç‰ˆæœ¬æ§åˆ¶ã€‚

```python
class DataSourceManager:
    """æ•°æ®æºç®¡ç†å™¨"""
    
    def __init__(self, db_manager):
        self.db_manager = db_manager
        self.metadata_collection = 'data_source_metadata'
    
    def register_data_source(self, source_config):
        """æ³¨å†Œæ–°çš„æ•°æ®æº"""
        metadata = {
            'source_id': self._generate_source_id(),
            'source_name': source_config.name,
            'source_type': source_config.type,  # csv/database/api
            'upload_time': datetime.utcnow(),
            'field_schema': source_config.schema,
            'record_count': source_config.record_count,
            'data_quality_score': self._calculate_quality_score(source_config),
            'version': 1,
            'status': 'active'
        }
        return self.db_manager.insert_one(self.metadata_collection, metadata)
    
    def create_matching_project(self, project_config):
        """åˆ›å»ºåŒ¹é…é¡¹ç›®"""
        project = {
            'project_id': self._generate_project_id(),
            'project_name': project_config.name,
            'primary_source_id': project_config.primary_source,
            'comparison_source_ids': project_config.comparison_sources,
            'field_mapping': project_config.field_mapping,
            'matching_strategy': project_config.strategy,
            'created_time': datetime.utcnow(),
            'status': 'draft'
        }
        return project
```

#### 3.2 åŒ¹é…é¡¹ç›®ç®¡ç†
**åŠŸèƒ½æè¿°**ï¼šæ”¯æŒåˆ›å»ºã€ä¿å­˜ã€åŠ è½½åŒ¹é…é¡¹ç›®ï¼Œä¾¿äºé…ç½®å¤ç”¨å’Œç»“æœç®¡ç†ã€‚

**é¡¹ç›®ç»“æ„**ï¼š
```json
{
  "project_id": "proj_20240804_001",
  "project_name": "ä¼ä¸šç¨åŠ¡è®°å½•å…³è”é¡¹ç›®",
  "description": "å°†ä¼ä¸šåŸºç¡€ä¿¡æ¯ä¸ç¨åŠ¡ç¼´çº³è®°å½•è¿›è¡Œå…³è”åŒ¹é…",
  "created_time": "2024-08-04T12:00:00Z",
  "updated_time": "2024-08-04T14:30:00Z",
  "status": "completed",
  
  "data_sources": {
    "primary": {
      "source_id": "src_company_master",
      "table_name": "company_master_data",
      "record_count": 50000,
      "key_fields": ["company_name", "credit_code"]
    },
    "comparison": [
      {
        "source_id": "src_tax_records", 
        "table_name": "tax_payment_records",
        "record_count": 120000,
        "key_fields": ["taxpayer_name", "taxpayer_id"]
      }
    ]
  },
  
  "matching_config": {
    "field_mappings": [...],
    "algorithms": [...],
    "thresholds": {...}
  },
  
  "execution_history": [
    {
      "execution_id": "exec_001",
      "start_time": "2024-08-04T13:00:00Z",
      "end_time": "2024-08-04T13:45:00Z",
      "status": "completed",
      "results_summary": {
        "total_processed": 50000,
        "exact_matches": 35000,
        "fuzzy_matches": 12000,
        "no_matches": 3000
      }
    }
  ]
}
```

### å››ã€ç”¨æˆ·ç•Œé¢å‡çº§

#### 4.1 é¡¹ç›®å‘å¯¼ç•Œé¢
**åŠŸèƒ½æè¿°**ï¼šæä¾›åˆ†æ­¥éª¤çš„é¡¹ç›®åˆ›å»ºå‘å¯¼ï¼Œå¼•å¯¼ç”¨æˆ·å®Œæˆæ•°æ®ä¸Šä¼ ã€å­—æ®µæ˜ å°„ã€å‚æ•°é…ç½®ç­‰æ“ä½œã€‚

**å‘å¯¼æ­¥éª¤**ï¼š
1. **é¡¹ç›®åŸºæœ¬ä¿¡æ¯**ï¼šé¡¹ç›®åç§°ã€æè¿°ã€ç›®æ ‡
2. **æ•°æ®æºä¸Šä¼ **ï¼šä¸»è¡¨å’Œå¯¹æ¯”è¡¨æ–‡ä»¶ä¸Šä¼ 
3. **å­—æ®µç»“æ„é¢„è§ˆ**ï¼šè‡ªåŠ¨åˆ†æçš„å­—æ®µç»“æ„ç¡®è®¤
4. **å­—æ®µæ˜ å°„é…ç½®**ï¼šæ‹–æ‹½å¼å­—æ®µå…³è”è®¾ç½®
5. **åŒ¹é…ç­–ç•¥é…ç½®**ï¼šç®—æ³•é€‰æ‹©ã€æƒé‡è°ƒæ•´ã€é˜ˆå€¼è®¾ç½®
6. **é¢„æ‰§è¡ŒéªŒè¯**ï¼šå°æ ·æœ¬æµ‹è¯•å’Œç»“æœé¢„è§ˆ
7. **æ­£å¼æ‰§è¡Œ**ï¼šå…¨é‡æ•°æ®åŒ¹é…å¤„ç†

#### 4.2 é…ç½®å¯è§†åŒ–ç•Œé¢
**åŠŸèƒ½æè¿°**ï¼šæä¾›å›¾å½¢åŒ–çš„é…ç½®ç•Œé¢ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œè°ƒæ•´ã€‚

```html
<!-- å­—æ®µæ˜ å°„å¯è§†åŒ– -->
<div class="mapping-visualization">
    <div class="field-mapping-graph">
        <svg id="mapping-svg" width="100%" height="400">
            <!-- D3.jsç»˜åˆ¶çš„å­—æ®µå…³è”å›¾ -->
        </svg>
    </div>
    
    <div class="mapping-controls">
        <div class="similarity-config">
            <h4>ç›¸ä¼¼åº¦ç®—æ³•é…ç½®</h4>
            <div class="algorithm-weights">
                <label>ç¼–è¾‘è·ç¦»æƒé‡: <input type="range" min="0" max="1" step="0.1" value="0.3"></label>
                <label>è¯­ä¹‰ç›¸ä¼¼åº¦æƒé‡: <input type="range" min="0" max="1" step="0.1" value="0.4"></label>
                <label>æ‹¼éŸ³ç›¸ä¼¼åº¦æƒé‡: <input type="range" min="0" max="1" step="0.1" value="0.3"></label>
            </div>
        </div>
    </div>
</div>
```

#### 4.3 å®æ—¶é¢„è§ˆåŠŸèƒ½
**åŠŸèƒ½æè¿°**ï¼šåœ¨é…ç½®è¿‡ç¨‹ä¸­æä¾›å®æ—¶çš„å°æ ·æœ¬åŒ¹é…é¢„è§ˆï¼Œå¸®åŠ©ç”¨æˆ·è°ƒä¼˜å‚æ•°ã€‚

```python
class RealTimePreview:
    """å®æ—¶é¢„è§ˆåŠŸèƒ½"""
    
    def __init__(self, db_manager):
        self.db_manager = db_manager
        self.sample_size = 100  # é¢„è§ˆæ ·æœ¬å¤§å°
    
    def generate_preview(self, field_mapping_config, algorithm_config):
        """ç”ŸæˆåŒ¹é…é¢„è§ˆç»“æœ"""
        # 1. ä»ä¸»è¡¨éšæœºæŠ½å–æ ·æœ¬
        sample_records = self._get_sample_records(field_mapping_config.primary_table)
        
        # 2. æ‰§è¡Œå°è§„æ¨¡åŒ¹é…
        preview_results = []
        for record in sample_records:
            match_result = self._preview_match_single(record, field_mapping_config, algorithm_config)
            preview_results.append(match_result)
        
        # 3. ç”Ÿæˆé¢„è§ˆç»Ÿè®¡
        preview_stats = self._calculate_preview_stats(preview_results)
        
        return {
            'preview_results': preview_results[:10],  # è¿”å›å‰10æ¡ç»“æœ
            'statistics': preview_stats,
            'estimated_performance': self._estimate_full_performance(preview_stats)
        }
```

### äº”ã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡

#### 5.1 æ™ºèƒ½æ‰¹å¤„ç†ç­–ç•¥
**åŠŸèƒ½æè¿°**ï¼šæ ¹æ®æ•°æ®è§„æ¨¡å’Œç³»ç»Ÿèµ„æºè‡ªåŠ¨è°ƒæ•´æ‰¹å¤„ç†å¤§å°å’Œå¹¶å‘ç­–ç•¥ã€‚

```python
class AdaptiveBatchProcessor:
    """è‡ªé€‚åº”æ‰¹å¤„ç†å™¨"""
    
    def __init__(self, system_monitor):
        self.system_monitor = system_monitor
        self.performance_history = []
    
    def calculate_optimal_batch_size(self, data_size, field_complexity):
        """è®¡ç®—æœ€ä¼˜æ‰¹å¤„ç†å¤§å°"""
        # åŸºäºç³»ç»Ÿèµ„æºã€æ•°æ®è§„æ¨¡ã€å­—æ®µå¤æ‚åº¦è®¡ç®—
        base_batch_size = 1000
        
        # CPUåˆ©ç”¨ç‡è°ƒæ•´
        cpu_factor = 1.0 - self.system_monitor.get_cpu_usage() / 100
        
        # å†…å­˜ä½¿ç”¨ç‡è°ƒæ•´  
        memory_factor = 1.0 - self.system_monitor.get_memory_usage() / 100
        
        # å­—æ®µå¤æ‚åº¦è°ƒæ•´
        complexity_factor = 1.0 / (1 + field_complexity * 0.1)
        
        optimal_size = int(base_batch_size * cpu_factor * memory_factor * complexity_factor)
        return max(100, min(optimal_size, 5000))  # é™åˆ¶åœ¨100-5000ä¹‹é—´
```

#### 5.2 ç¼“å­˜ç­–ç•¥å¢å¼º
**åŠŸèƒ½æè¿°**ï¼šå¢å¼ºç°æœ‰çš„Redisç¼“å­˜ç­–ç•¥ï¼Œæ”¯æŒå¤šå±‚çº§ç¼“å­˜å’Œæ™ºèƒ½ç¼“å­˜æ¸…ç†ã€‚

```python
class EnhancedCacheManager:
    """å¢å¼ºç¼“å­˜ç®¡ç†å™¨"""
    
    def __init__(self, redis_client):
        self.redis = redis_client
        self.cache_levels = {
            'L1': {'ttl': 300, 'size_limit': '100MB'},      # çƒ­ç‚¹æ•°æ®
            'L2': {'ttl': 3600, 'size_limit': '500MB'},     # å¸¸ç”¨æ•°æ®  
            'L3': {'ttl': 86400, 'size_limit': '1GB'}       # å†·æ•°æ®
        }
    
    def cache_similarity_result(self, key, result, access_pattern='normal'):
        """ç¼“å­˜ç›¸ä¼¼åº¦è®¡ç®—ç»“æœ"""
        cache_level = self._determine_cache_level(access_pattern)
        ttl = self.cache_levels[cache_level]['ttl']
        self.redis.setex(f"{cache_level}:{key}", ttl, json.dumps(result))
    
    def get_cached_similarity(self, key):
        """è·å–ç¼“å­˜çš„ç›¸ä¼¼åº¦ç»“æœ"""
        for level in ['L1', 'L2', 'L3']:
            cached = self.redis.get(f"{level}:{key}")
            if cached:
                # ç¼“å­˜å‘½ä¸­ï¼Œæ›´æ–°è®¿é—®æ¨¡å¼
                self._update_access_pattern(key)
                return json.loads(cached)
        return None
```

### å…­ã€ç»“æœåˆ†æå¢å¼º

#### 6.1 åŒ¹é…è´¨é‡è¯„ä¼°
**åŠŸèƒ½æè¿°**ï¼šæä¾›å¤šç»´åº¦çš„åŒ¹é…è´¨é‡è¯„ä¼°ï¼ŒåŒ…æ‹¬å‡†ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°ç­‰æŒ‡æ ‡ã€‚

```python
class MatchQualityAnalyzer:
    """åŒ¹é…è´¨é‡åˆ†æå™¨"""
    
    def __init__(self):
        self.quality_metrics = [
            'precision',      # ç²¾ç¡®ç‡
            'recall',         # å¬å›ç‡  
            'f1_score',       # F1åˆ†æ•°
            'accuracy',       # å‡†ç¡®ç‡
            'coverage',       # è¦†ç›–ç‡
            'confidence_distribution'  # ç½®ä¿¡åº¦åˆ†å¸ƒ
        ]
    
    def analyze_match_results(self, match_results, ground_truth=None):
        """åˆ†æåŒ¹é…ç»“æœè´¨é‡"""
        analysis = {
            'total_records': len(match_results),
            'match_distribution': self._calculate_match_distribution(match_results),
            'similarity_distribution': self._calculate_similarity_distribution(match_results),
            'confidence_analysis': self._analyze_confidence_levels(match_results)
        }
        
        if ground_truth:
            analysis.update(self._calculate_accuracy_metrics(match_results, ground_truth))
        
        return analysis
    
    def generate_quality_report(self, analysis_result):
        """ç”Ÿæˆè´¨é‡è¯„ä¼°æŠ¥å‘Š"""
        report = {
            'overall_score': self._calculate_overall_score(analysis_result),
            'quality_indicators': self._extract_quality_indicators(analysis_result),
            'improvement_suggestions': self._generate_improvement_suggestions(analysis_result),
            'risk_assessment': self._assess_matching_risks(analysis_result)
        }
        return report
```

#### 6.2 äº¤äº’å¼ç»“æœéªŒè¯
**åŠŸèƒ½æè¿°**ï¼šæä¾›æ›´ä¸°å¯Œçš„äººå·¥å®¡æ ¸ç•Œé¢ï¼Œæ”¯æŒæ‰¹é‡å®¡æ ¸ã€æ™ºèƒ½æ¨èç­‰åŠŸèƒ½ã€‚

```html
<!-- å¢å¼ºçš„å®¡æ ¸ç•Œé¢ -->
<div class="enhanced-review-interface">
    <div class="review-toolbar">
        <button class="batch-approve">æ‰¹é‡é€šè¿‡é«˜åˆ†åŒ¹é…</button>
        <button class="batch-reject">æ‰¹é‡æ‹’ç»ä½åˆ†åŒ¹é…</button>
        <button class="smart-recommend">æ™ºèƒ½æ¨è</button>
        <select id="confidence-filter">
            <option value="all">æ‰€æœ‰ç½®ä¿¡åº¦</option>
            <option value="high">é«˜ç½®ä¿¡åº¦(>0.9)</option>
            <option value="medium">ä¸­ç­‰ç½®ä¿¡åº¦(0.7-0.9)</option>
            <option value="low">ä½ç½®ä¿¡åº¦(<0.7)</option>
        </select>
    </div>
    
    <div class="review-grid">
        <div class="match-card" data-match-id="match_001">
            <div class="similarity-indicator">
                <div class="score-circle" data-score="0.85">85%</div>
            </div>
            <div class="record-comparison">
                <div class="primary-record">
                    <h4>ä¸»è®°å½•</h4>
                    <div class="field-values">
                        <div class="field">
                            <label>å…¬å¸åç§°:</label>
                            <span class="value highlight">åŒ—äº¬ç§‘æŠ€æœ‰é™å…¬å¸</span>
                        </div>
                    </div>
                </div>
                <div class="matched-record">
                    <h4>åŒ¹é…è®°å½•</h4>
                    <div class="field-values">
                        <div class="field">
                            <label>çº³ç¨äººåç§°:</label>
                            <span class="value highlight">åŒ—äº¬ç§‘æŠ€æœ‰é™è´£ä»»å…¬å¸</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="review-actions">
                <button class="approve-btn">âœ“ é€šè¿‡</button>
                <button class="reject-btn">âœ— æ‹’ç»</button>
                <button class="flag-btn">ğŸ æ ‡è®°</button>
            </div>
        </div>
    </div>
</div>
```

### ä¸ƒã€ç³»ç»Ÿæ‰©å±•æ€§è®¾è®¡

#### 7.1 æ’ä»¶åŒ–ç®—æ³•æ¡†æ¶
**åŠŸèƒ½æè¿°**ï¼šè®¾è®¡æ’ä»¶åŒ–çš„ç®—æ³•æ¡†æ¶ï¼Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç›¸ä¼¼åº¦ç®—æ³•å’ŒåŒ¹é…ç­–ç•¥ã€‚

```python
class AlgorithmPlugin:
    """ç®—æ³•æ’ä»¶åŸºç±»"""
    
    def __init__(self, name, version, description):
        self.name = name
        self.version = version  
        self.description = description
        self.supported_field_types = []
    
    @abstractmethod
    def calculate_similarity(self, value1, value2, config=None):
        """è®¡ç®—ç›¸ä¼¼åº¦çš„æŠ½è±¡æ–¹æ³•"""
        pass
    
    @abstractmethod
    def get_config_schema(self):
        """è·å–é…ç½®æ¨¡å¼"""
        pass

class CustomNameSimilarityPlugin(AlgorithmPlugin):
    """è‡ªå®šä¹‰å§“åç›¸ä¼¼åº¦æ’ä»¶ç¤ºä¾‹"""
    
    def __init__(self):
        super().__init__(
            name="custom_name_similarity",
            version="1.0.0", 
            description="é’ˆå¯¹ä¸­æ–‡å§“åä¼˜åŒ–çš„ç›¸ä¼¼åº¦ç®—æ³•"
        )
        self.supported_field_types = ['person_name', 'contact_person']
    
    def calculate_similarity(self, name1, name2, config=None):
        # å®ç°è‡ªå®šä¹‰çš„å§“åç›¸ä¼¼åº¦è®¡ç®—é€»è¾‘
        pass
```

#### 7.2 APIæ¥å£è®¾è®¡
**åŠŸèƒ½æè¿°**ï¼šæä¾›RESTful APIæ¥å£ï¼Œæ”¯æŒå¤–éƒ¨ç³»ç»Ÿé›†æˆå’Œæ‰¹é‡å¤„ç†ã€‚

```python
@app.route('/api/v2/projects', methods=['POST'])
def create_matching_project():
    """åˆ›å»ºåŒ¹é…é¡¹ç›®API"""
    pass

@app.route('/api/v2/projects/<project_id>/execute', methods=['POST'])  
def execute_matching_project(project_id):
    """æ‰§è¡ŒåŒ¹é…é¡¹ç›®API"""
    pass

@app.route('/api/v2/projects/<project_id>/results', methods=['GET'])
def get_matching_results(project_id):
    """è·å–åŒ¹é…ç»“æœAPI"""
    pass

@app.route('/api/v2/similarity/calculate', methods=['POST'])
def calculate_similarity():
    """ç›¸ä¼¼åº¦è®¡ç®—API"""
    pass
```

## ğŸ› ï¸ æŠ€æœ¯å®ç°è·¯å¾„

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¶æ„å‡çº§ï¼ˆ2-3å‘¨ï¼‰
1. **æ•°æ®æ¨¡å‹é‡æ„**ï¼šè®¾è®¡é€šç”¨çš„æ•°æ®æºå’Œé¡¹ç›®ç®¡ç†æ¨¡å‹
2. **CSVå¤„ç†æ¨¡å—**ï¼šå®ç°æ–‡ä»¶ä¸Šä¼ ã€è§£æã€éªŒè¯åŠŸèƒ½  
3. **åŠ¨æ€é…ç½®ç³»ç»Ÿ**ï¼šå®ç°å¯é…ç½®çš„å­—æ®µæ˜ å°„å’ŒåŒ¹é…ç­–ç•¥
4. **åŸºç¡€Webç•Œé¢**ï¼šé¡¹ç›®å‘å¯¼å’Œé…ç½®ç•Œé¢

### é˜¶æ®µäºŒï¼šç®—æ³•å¢å¼ºï¼ˆ2-3å‘¨ï¼‰
1. **åŠ¨æ€åŒ¹é…ç­–ç•¥**ï¼šåŸºäºé…ç½®è‡ªåŠ¨ç”ŸæˆåŒ¹é…ç­–ç•¥
2. **æ™ºèƒ½ç®—æ³•é€‰æ‹©**ï¼šæ ¹æ®å­—æ®µç±»å‹è‡ªåŠ¨é€‰æ‹©ç®—æ³•
3. **å®æ—¶é¢„è§ˆåŠŸèƒ½**ï¼šå°æ ·æœ¬åŒ¹é…é¢„è§ˆå’Œå‚æ•°è°ƒä¼˜
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šè‡ªé€‚åº”æ‰¹å¤„ç†å’Œç¼“å­˜å¢å¼º

### é˜¶æ®µä¸‰ï¼šç•Œé¢å®Œå–„ï¼ˆ1-2å‘¨ï¼‰
1. **å¯è§†åŒ–é…ç½®**ï¼šå­—æ®µæ˜ å°„å¯è§†åŒ–ç•Œé¢
2. **ç»“æœåˆ†æ**ï¼šåŒ¹é…è´¨é‡è¯„ä¼°å’ŒæŠ¥å‘Šç”Ÿæˆ
3. **äº¤äº’å¼å®¡æ ¸**ï¼šå¢å¼ºçš„äººå·¥å®¡æ ¸ç•Œé¢
4. **é¡¹ç›®ç®¡ç†**ï¼šé¡¹ç›®ä¿å­˜ã€åŠ è½½ã€å¤ç”¨åŠŸèƒ½

### é˜¶æ®µå››ï¼šæ‰©å±•åŠŸèƒ½ï¼ˆ1-2å‘¨ï¼‰
1. **æ’ä»¶ç³»ç»Ÿ**ï¼šç®—æ³•æ’ä»¶æ¡†æ¶
2. **APIæ¥å£**ï¼šå¤–éƒ¨ç³»ç»Ÿé›†æˆæ¥å£
3. **æ‰¹é‡å¤„ç†**ï¼šå¤§æ•°æ®é‡å¤„ç†ä¼˜åŒ–
4. **ç›‘æ§å‘Šè­¦**ï¼šç³»ç»Ÿç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦

## ğŸ“‹ å…¼å®¹æ€§ä¿éšœ

### ç°æœ‰åŠŸèƒ½ä¿ç•™
1. **V1.0æ‰€æœ‰åŠŸèƒ½å®Œå…¨ä¿ç•™**ï¼šç°æœ‰çš„æ¶ˆé˜²ç³»ç»ŸåŒ¹é…åŠŸèƒ½ä½œä¸ºå†…ç½®æ¨¡æ¿ä¿å­˜
2. **æ•°æ®ç»“æ„å…¼å®¹**ï¼šç°æœ‰æ•°æ®åº“ç»“æ„ä¿æŒä¸å˜ï¼Œæ–°åŠŸèƒ½é€šè¿‡æ‰©å±•å®ç°
3. **ç•Œé¢æ¸è¿›å‡çº§**ï¼šä¿ç•™åŸæœ‰ç•Œé¢ï¼Œæ–°åŠŸèƒ½ä½œä¸ºå¢å¼ºé€‰é¡¹æä¾›
4. **é…ç½®æ–‡ä»¶å…¼å®¹**ï¼šç°æœ‰YAMLé…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒå…¼å®¹

### è¿ç§»ç­–ç•¥
1. **å¹³æ»‘å‡çº§**ï¼šV1.0ç”¨æˆ·å¯ä»¥æ— ç¼å‡çº§åˆ°V2.0
2. **æ¨¡æ¿å¯¼å…¥**ï¼šç°æœ‰çš„æ¶ˆé˜²ç³»ç»Ÿé…ç½®å¯ä»¥ä½œä¸ºæ¨¡æ¿å¯¼å…¥
3. **æ•°æ®è¿ç§»**ï¼šæä¾›æ•°æ®è¿ç§»å·¥å…·ï¼Œç¡®ä¿å†å²æ•°æ®ä¸ä¸¢å¤±
4. **åŸ¹è®­æ”¯æŒ**ï¼šæä¾›è¯¦ç»†çš„å‡çº§æŒ‡å—å’Œæ“ä½œåŸ¹è®­

## ğŸ¯ é¢„æœŸæ•ˆæœ

### åŠŸèƒ½æå‡
- **é€šç”¨æ€§**ï¼šä»ç‰¹å®šè¡Œä¸šæ‰©å±•åˆ°é€šç”¨æ•°æ®åŒ¹é…å¹³å°
- **æ˜“ç”¨æ€§**ï¼šç”¨æˆ·å‹å¥½çš„é…ç½®ç•Œé¢ï¼Œé™ä½ä½¿ç”¨é—¨æ§›
- **çµæ´»æ€§**ï¼šæ”¯æŒä»»æ„å­—æ®µç»„åˆå’Œè‡ªå®šä¹‰åŒ¹é…ç­–ç•¥
- **å‡†ç¡®æ€§**ï¼šæ™ºèƒ½ç®—æ³•é€‰æ‹©æå‡åŒ¹é…å‡†ç¡®ç‡

### æ€§èƒ½æå‡
- **å¤„ç†é€Ÿåº¦**ï¼šè‡ªé€‚åº”æ‰¹å¤„ç†æå‡å¤§æ•°æ®å¤„ç†é€Ÿåº¦
- **èµ„æºåˆ©ç”¨**ï¼šæ™ºèƒ½ç¼“å­˜ç­–ç•¥ä¼˜åŒ–å†…å­˜å’ŒCPUä½¿ç”¨
- **æ‰©å±•æ€§**ï¼šæ’ä»¶åŒ–æ¶æ„æ”¯æŒåŠŸèƒ½æ‰©å±•
- **ç¨³å®šæ€§**ï¼šå¢å¼ºçš„é”™è¯¯å¤„ç†å’Œç›‘æ§æœºåˆ¶

### å•†ä¸šä»·å€¼
- **é€‚ç”¨èŒƒå›´æ‰©å¤§**ï¼šä»æ¶ˆé˜²è¡Œä¸šæ‰©å±•åˆ°å„è¡Œå„ä¸š
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šç®€åŒ–é…ç½®æµç¨‹ï¼Œæé«˜æ“ä½œæ•ˆç‡
- **æŠ€æœ¯é¢†å…ˆæ€§**ï¼šä¸šç•Œé¢†å…ˆçš„æ™ºèƒ½åŒ¹é…ç®—æ³•
- **å¸‚åœºç«äº‰åŠ›**ï¼šé€šç”¨åŒ–çš„äº§å“å®šä½å¢å¼ºå¸‚åœºç«äº‰åŠ›

---

## ğŸ“ æ€»ç»“

æ™ºèƒ½å…³è”åŒ¹é…ç³»ç»ŸV2.0åœ¨ä¿æŒV1.0æ‰€æœ‰ä¼˜ç§€ç‰¹æ€§çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¼•å…¥CSVæ•°æ®æºæ”¯æŒã€å¯è§†åŒ–é…ç½®ç•Œé¢ã€åŠ¨æ€åŒ¹é…ç­–ç•¥ç­‰åˆ›æ–°åŠŸèƒ½ï¼Œå°†ç³»ç»Ÿä»ç‰¹å®šè¡Œä¸šåº”ç”¨å‡çº§ä¸ºé€šç”¨çš„æ™ºèƒ½æ•°æ®åŒ¹é…å¹³å°ã€‚è¯¥è®¾è®¡å……åˆ†è€ƒè™‘äº†ç”¨æˆ·éœ€æ±‚ã€æŠ€æœ¯å¯è¡Œæ€§å’Œç³»ç»Ÿæ‰©å±•æ€§ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ˜“äºä½¿ç”¨çš„æ•°æ®å…³è”åˆ†æå·¥å…·ã€‚